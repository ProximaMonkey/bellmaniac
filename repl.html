<html>
<head>
	<meta charset="UTF-8">
	<script src="node_modules/jquery/dist/jquery.min.js"></script>
	<script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
	<script src="node_modules/nearley/lib/nearley.js"></script>
	<script src="node_modules/codemirror/lib/codemirror.js"></script>
	<script src="node_modules/codemirror/mode/scheme/scheme.js"></script>
	<script src="node_modules/codemirror/addon/hint/show-hint.js"></script>
	<script src="node_modules/codemirror/addon/selection/active-line.js"></script>
	<script src="node_modules/angular/angular.js"></script>
	<script src="node_modules/angular-recursion/angular-recursion.js"></script>
	<script src="node_modules/angular-ui-codemirror/src/ui-codemirror.js"></script>
	<script src="node_modules/angular-ui-select/select.js"></script>

    <script src="src/editor/bellmania-mode.js"></script>
    <script src="src/editor/matchbrackets-patched.js"></script>
    <script src="src/editor/editor.ls.js"></script>

	<script src="src/parse-utils.ls.js"></script>
	<script src="src/lambda.ne.js"></script>
	<script src="src/parse.ls.js"></script>
	<script src="src/repl.ls.js"></script>
	<script src="../web.realtime/reload.js"></script>

	<link rel="stylesheet" href="node_modules/codemirror/lib/codemirror.css">
	<link rel="stylesheet" href="node_modules/codemirror/theme/neat.css">
	<link rel="stylesheet" href="node_modules/codemirror/addon/hint/show-hint.css">
	<link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="src/index.css">
</head>
<body>
	<div ng-app="app" ng-controller="Ctrl">
		<div class="container">
			<h1>Bellmania Interface</h1>
			<p>Press Cmd-Enter in the code editor to parse current code.</p>
		</div>
		<div class="container" ng-repeat="h in history">
			<hr ng-if="$index > 0">
			<div class="row">
				<span ng-show="isInvalid(h)" class="label label-danger pull-right icon">OUTDATED</span>
			</div>
			<div class="row">
				<div class="col-xs-1">{{"In[" + h.id + "]"}}</div>
				<div class="col-xs-11">
					<textarea ui-codemirror="{ onLoad : wrapper(h), indentWithTabs : true }" ui-codemirror-opts="cmOptions" ng-model="h.input"></textarea>
				</div>
			</div>
			<div ng-show="h.error.length > 0" class="alert alert-danger">{{h.error}}</div>
			<div class="row" ng-if="h.output">
				<br>
				<div class="col-xs-1">{{"Out[" + h.id + "]"}}</div>
				<div class="col-xs-11">
					<div class="cell" ng-repeat="cell in h.output | orderBy:'index'">
						<display o="cell.value"></display>
					</div>
				</div>
			</div>
		</div>
	</div>
	<template type="text/ng-template" id="display">
        <display ng-if="o.display" o="o.display"></display>
		<compute ng-if="o.tape" let="parts = o | display">
			<span class="code"
			 ng-class="mark[1]"
			 data-tip="{{mark[2]}}"
			 ng-repeat="mark in parts track by $index">{{mark[0]}}</span>
		</compute>
		<div ng-if="o.vbox" ng-repeat="el in o.vbox">
			<display o="el"></display>
		</div>
		<ul ng-if="o.list">
			<li ng-repeat="el in o.list">
				<display o="el"></display>
			</li>
		</ul>
		<ul ng-if="o.tree" class="c" bullet="{{o.bullet}}">
			<li>
				<display o="o.tree.root"></display>
				<display ng-repeat="s in o.tree.subtrees" o="{tree: s}"></display>
			</li>
		</ul>
		<span class="code" ng-if="o | isString">{{o}}</span>
	</template>
</body>
</html>